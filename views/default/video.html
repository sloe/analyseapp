{{extend 'layout.html'}}

<h1>Oarstack secret testing site</h1>

  <link href="{{=URL("static", "video-js/video-js.css")}}" rel="stylesheet" type="text/css">
  <link href="{{=URL("static", "video-js/videojs.markers.css")}}" rel="stylesheet" type="text/css">
  <link href="{{=URL("static", "jslib/backgrid-0.3.5.css")}}" rel="stylesheet" type="text/css">
  <!-- video.js must be in the <head> for older IEs to work. -->
  <script src="{{=URL("static", "video-js/video.dev.js")}}"></script>
  <script src="{{=URL("static", "video-js/video-framebyframe.js")}}"></script>
  <script src="{{=URL("static", "video-js/videojs-markers.js")}}"></script>
  <script src="{{=URL("static", "sloejs/video-sloe.js")}}"></script>
  <script src="{{=URL("static", "jslib/underscore-1.7.0.js")}}"></script>
  <script src="{{=URL("static", "jslib/backbone-1.1.2.js")}}"></script>
  <script src="{{=URL("static", "jslib/backgrid-0.3.5.js")}}"></script>
  <script src="{{=URL("static", "sloejs/video-sloe.js")}}"></script>

  <!-- Unless using the CDN hosted version, update the URL to the Flash SWF -->
  <script>
    videojs.options.flash.swf = "{{=URL("static", "video-js/video-js.swf")}}";
    videojs.options.sloestatic= {
      url: "{{=URL("", scheme=True, host=True)}}",
      linkform: "{{=str(link_form)}}",
      size: "{{="%dx%d" % (width, height)}}"
      };
  </script>
{{=size_form}}
{{=size_script}}
{{=selector_form}}
{{=selector_script}}

{{ if not gdrive_found or len(gdrive_found) == 0: }}
Video not found for this item
{{ else: }}
<video id="sloe-video-main" class="video-js vjs-default-skin" controls preload="auto" width="{{=width}}" height="{{=height}}"
    data-setup='{ "playbackRates": [0.0625, 0.125, 0.25, 0.5, 1, 2, 4] }'>
  <source src="https://googledrive.com/host/{{=gdrive_found[0]['id']}}" type='video/mp4' />
  <!-- <source src="{{=URL('static', 'oarstack/final/derived/hoc2014/div4/403 Peterhouse M2 Beach Ball 3rd Mays 8+ yt8.mp4')}}" type='video/mp4' /> -->

  <p class="vjs-no-js">To view this video please enable JavaScript, and consider upgrading to a web browser that <a href="http://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a></p>
</video>
<script type='text/javascript'>
    var video = videojs("sloe-video-main", {
      controls: true,
      autoplay: true,
      preload: 'auto',
      plugins: {
        sloenudge: {
          fps: {{=fps}},
          speed_factor: {{=speed_factor}},
          steps: [
            '-1.75s',
            '-0.5s',
            '-16f',
            '-4f',
            '-1f',
            '1f',
            '4f',
            '16f',
            '0.5s',
            '1.75s'
          ]
        },

        sloe: {
          fps: {{=fps}},
          speed_factor: {{=speed_factor}},
        }
      }
    });
  </script>

{{=DIV(
INPUT(_type="text", _id="sloe-link-url", _value=URL("", scheme=True, host=True), _style="width:600px;"),
INPUT(_type="button", _id="sloe-link-test-button", _value="Test"),
INPUT(_type="button", _id="sloe-link-reset-button", _value="Reset"),
_class="sloe-link-control",
_id="sloe-=link-control")
}}
{{=link_form}}

{{=DIV(TABLE([], _class='sloe-marker-table', _id='sloe-marker-table'), _class='sloe-video-info', _id='sloe-video-info')}}
{{=DIV(XML('(This table can be pasted into a spreadsheet)'))}}

{{ pass }}

{{if final_item:}}
<h3>This item:</h3>
{{=DIV(BEAUTIFY(final_item._d))}}
{{pass}}
{{if gdrive_found:}}
<h3>Google Drive item details:</h3>
{{=DIV(BEAUTIFY(gdrive_found))}}
{{pass}}
{{if genspec:}}
<h3>Generation details:</h3>
{{=DIV(BEAUTIFY(genspec._d))}}
{{pass}}
{{if source_item:}}
<h3>Source item (primary):</h3>
{{=DIV(BEAUTIFY(source_item._d))}}
{{pass}}
{{if remoteitems:}}
<h3>Remote items:</h3>
{{for remoteitem in remoteitems:}}
{{=DIV(BEAUTIFY(remoteitem._d))}}
{{pass}}
{{pass}}
